<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Mama Moon | Search</title>
    <link rel="stylesheet" href="cleaned-clothes.css">
  </head>
  <body>
    <div id="header-placeholder"></div>

    <main class="search-results">
      <h2>Search Results</h2>
      <aside class="filter-sidebar">
        <h3>Filters</h3>
        <label>Category:</label>
        <select id="filter-category">
          <option value="">All</option>
          <option value="candles">Candles</option>
          <option value="bracelets">Bracelets</option>
          <option value="necklaces">Necklaces</option>
          <option value="other">Other</option>
        </select>

        <label>Scent Group:</label>
        <select id="filter-group">
          <option value="">All</option>
          <option value="sweet">Sweet</option>
          <option value="spicy">Spicy</option>
          <option value="holiday">Holiday</option>
          <option value="floral">Floral</option>
        </select>
      </aside>
      <div id="results-grid" class="product-grid"></div>
    </main>

    <script src="organs.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Load the universal header
      const headerHTML = await (await fetch('header.html')).text();
      document.getElementById('header-placeholder').innerHTML = headerHTML;

      // --- Grab elements ---
      const params = new URLSearchParams(window.location.search);
      const query = params.get('query') || '';

      const categorySelect = document.getElementById('filter-category');
      const groupSelect = document.getElementById('filter-group');
      const grid = document.getElementById('results-grid');

      async function loadResults() {
      const url = new URL('/MamaMoon/nuerons.php', window.location.origin);

        if (query) url.searchParams.append('query', query);
        if (categorySelect?.value) url.searchParams.append('category', categorySelect.value);
        if (groupSelect?.value) url.searchParams.append('group', groupSelect.value);

        // ✨ Fade out before loading
        grid.classList.remove('loaded');
        grid.innerHTML = '<p>Loading...</p>';

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (!data.length) {
          grid.innerHTML = '<p>No products found.</p>';
        } else {
          grid.innerHTML = data.map(item => `
            <div class="product-box">
              <img src="${item.image_url}" alt="${item.name}">
              <p><strong>${item.name}</strong></p>
              <p>$${Number(item.price).toFixed(2)}</p>
              <p class="group-label">${item.scent_group || ''}</p>
            </div>
          `).join('');
        }

        // ✨ Fade-in after loading
        requestAnimationFrame(() => grid.classList.add('loaded'));
      } catch (err) {
        console.error('Error fetching search results:', err);
        grid.innerHTML = '<p>Failed to load products.</p>';
        requestAnimationFrame(() => grid.classList.add('loaded'));
      }
    }

    // --- Load on filter change ---
    categorySelect?.addEventListener('change', loadResults);
    groupSelect?.addEventListener('change', loadResults);

    // --- Initial load ---
    loadResults();
  });
  </script>

    </script>
  </body>
</html>
